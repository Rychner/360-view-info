<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Jalan Tokyo 360 — Navigasi & Info</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    html, body, #viewer {
      height: 100%;
      margin: 0;
      background: #000;
      overflow: hidden;
      font-family: 'Segoe UI', sans-serif;
    }

    /* Hotspot umum */
    .hotspot {
      position: absolute;
      transform: translate(-50%, -50%);
      cursor: pointer;
    }

    /* Ikon info */
    .hotspot.info img {
      width: 42px;
      height: 42px;
      border-radius: 50%;
      border: 2px solid #fff;
      box-shadow: 0 0 8px rgba(0, 0, 0, 0.6);
      background: rgba(255,255,255,0.1);
      transition: transform 0.2s;
    }
    .hotspot.info img:hover {
      transform: scale(1.2);
    }

    /* Ikon panah navigasi */
    .hotspot.link img {
      width: 50px;
      height: 50px;
      filter: drop-shadow(0 0 8px rgba(0,0,0,0.8));
      opacity: 0.9;
      transition: transform 0.2s;
    }
    .hotspot.link img:hover {
      transform: scale(1.3);
    }

    /* Box informasi */
    .info-box {
      position: absolute;
      bottom: 25px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.75);
      color: #fff;
      padding: 16px 20px;
      border-radius: 12px;
      max-width: 420px;
      text-align: center;
      display: none;
      animation: fadeIn 0.3s ease;
    }
    .info-box.show {
      display: block;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translate(-50%, 10px); }
      to { opacity: 1; transform: translate(-50%, 0); }
    }

  </style>
</head>
<body>
  <div id="viewer"></div>
  <div id="infoBox" class="info-box"></div>

  <!-- Library Marzipano -->
  <script src="https://unpkg.com/marzipano@0.10.1/dist/marzipano.js"></script>

  <script>
    const viewer = new Marzipano.Viewer(document.getElementById('viewer'));
    const infoBox = document.getElementById('infoBox');

    // === 1️⃣ Daftar scene (dua panorama jalan Tokyo) ===
    const scenesData = [
        {
            id: "tokyo1",
            image: "panorama2.jpg",
            infoHotspots: [
            {
                yaw: -0.2, pitch: 0.05,
                title: "Restoran Jepang",
                text: "Restoran ramen populer di Tokyo dengan nuansa klasik Jepang."
            },
            {
                yaw: 1.0, pitch: 0.1,
                title: "Bar Izakaya",
                text: "Tempat nongkrong malam hari dengan aneka minuman khas Jepang."
            }
            ],
            linkHotspots: [
            { yaw: 4.1, pitch: 0.1, target: "tokyo2", label: "Lanjut ke depan" }
            ]
        },
        {
            id: "tokyo2",
            image: "tokyo2.jpeg",
            infoHotspots: [
            {
                yaw: 0.5, pitch: 0.1,
                title: "Mini Market",
                text: "Toko serba ada khas Jepang yang buka 24 jam."
            },
            {
                yaw: -1.5, pitch: 0.05,
                title: "Stasiun Metro",
                text: "Pintu masuk ke stasiun bawah tanah Tokyo Metro Line."
            }
            ],
            linkHotspots: [
            { yaw: -2.3, pitch: 0.1, target: "tokyo1", label: "Kembali ke belakang" }
            ]
        }
    ];

    // === 2️⃣ Membuat scene ===
    const scenes = {};

    for (const data of scenesData) {
      const source = Marzipano.ImageUrlSource.fromString(data.image);
      const geometry = new Marzipano.EquirectGeometry([{ width: 4000 }]);
      const limiter = Marzipano.RectilinearView.limit.traditional(1024, 120 * Math.PI/180);
      const view = new Marzipano.RectilinearView({ yaw: 0, pitch: 0, fov: Math.PI/3 }, limiter);
      const scene = viewer.createScene({ source, geometry, view, pinFirstLevel: true });

      // --- Info hotspot ---
      data.infoHotspots.forEach(h => {
        const el = document.createElement("div");
        el.className = "hotspot info";
        el.innerHTML = `<img src="https://cdn-icons-png.flaticon.com/512/684/684908.png" alt="info">`;

        el.addEventListener("click", () => {
          infoBox.innerHTML = `<h3>${h.title}</h3><p>${h.text}</p>`;
          infoBox.classList.add("show");
          clearTimeout(window._hide);
          window._hide = setTimeout(() => infoBox.classList.remove("show"), 5000);
        });

        scene.hotspotContainer().createHotspot(el, { yaw: h.yaw, pitch: h.pitch });
      });

      // --- Link hotspot (navigasi) ---
      data.linkHotspots.forEach(link => {
        const el = document.createElement("div");
        el.className = "hotspot link";
        el.innerHTML = `<img src="https://cdn-icons-png.flaticon.com/512/318/318476.png" alt="arrow" style="transform: rotate(-90deg);">`;
        el.title = link.label;

        el.addEventListener("click", () => {
          scenes[link.target].switchTo({ transitionDuration: 800 });
          infoBox.classList.remove("show");
        });

        scene.hotspotContainer().createHotspot(el, { yaw: link.yaw, pitch: link.pitch });
      });

      scenes[data.id] = scene;
    }

    // === 3️⃣ Tampilkan scene pertama ===
    scenes["tokyo1"].switchTo();

    // === 4️⃣ Tutup info box jika klik sembarang tempat ===
    document.getElementById("viewer").addEventListener("click", e => {
      if (!e.target.closest(".hotspot")) infoBox.classList.remove("show");
    });
  </script>
</body>
</html>
